<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NEKO Token Airdrop</title>
    <script
      src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"
      type="application/javascript"
    ></script>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif;
        min-height: 100vh;
        background: linear-gradient(
          225deg,
          #2b1055 0%,
          #4158d0 20%,
          #c850c0 40%,
          #7f00ff 60%,
          #e100ff 80%,
          #4158d0 100%
        );
        background-size: 400% 400%;
        animation: gradientBG 20s ease infinite;
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 0;
        padding: 20px;
      }

      @keyframes gradientBG {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      .container {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-radius: 24px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        padding: 2.5rem;
        width: 100%;
        max-width: 500px;
        text-align: center;
      }

      .claim-wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1rem;
        width: 100%;
      }

      h1 {
        color: #2b1055;
        margin-bottom: 0.5rem;
      }

      .subtitle {
        color: #666;
        margin-bottom: 2rem;
      }

      button {
        background: linear-gradient(45deg, #7f00ff, #e100ff);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        width: 200px;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(127, 0, 255, 0.3);
      }

      button:disabled {
        opacity: 0.7;
        cursor: not-allowed;
      }

      .status-item {
        display: flex;
        flex-direction: column;
        gap: 8px;
        padding: 16px;
        border-radius: 8px;
        margin: 16px 0;
      }

      .status-item.success {
        color: #10b981;
        background: rgba(16, 185, 129, 0.1);
        border: 1px solid #10b981;
      }

      .status-item.error {
        color: #ef4444;
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid #ef4444;
      }

      .status-item.claimed {
        color: #6366f1;
        background: rgba(99, 102, 241, 0.1);
        border: 1px solid #6366f1;
      }

      .status-details {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 16px;
        margin-top: 12px;
      }

      .status-details p {
        margin: 8px 0;
        color: #666;
      }

      .status-details .note {
        color: #6366f1;
        font-style: italic;
        font-size: 0.9em;
        margin-top: 12px;
      }

      .address-info {
        background: rgba(255, 255, 255, 0.1);
        padding: 12px;
        border-radius: 8px;
        margin: 16px 0;
        word-break: break-all;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>NEKO CLAIM</h1>
      <p class="subtitle">‚ú® Get 10 NEKO tokens for free! ‚ú®</p>
      <div class="claim-wrapper">
        <div id="status"></div>
        <button id="connectWalletBtn" onclick="connectWallet()">
          Connect Wallet
        </button>
        <button
          id="claimTokensBtn"
          style="display: none"
          onclick="claimTokens()"
        >
          Claim 10 NEKO
        </button>
      </div>
    </div>

    <script>
      const AIRDROP_ADDRESS = "0x63a8E62B8C0A11780d6408fAbf53cED88848D9e8";
      let userAccount = null;
      let web3 = null;
      let contract = null;

      async function connectWallet() {
        if (typeof window.ethereum !== "undefined") {
          try {
            document.getElementById("connectWalletBtn").disabled = true;

            await window.ethereum.request({ method: "eth_requestAccounts" });
            const provider = new ethers.providers.Web3Provider(window.ethereum);
            const signer = provider.getSigner();
            const address = await signer.getAddress();

            const airdrop = new ethers.Contract(
              AIRDROP_ADDRESS,
              NekoAirdrop.abi,
              signer
            );

            const [isWhitelisted, hasClaimed] = await Promise.all([
              airdrop.whitelist(address),
              airdrop.hasClaimed(address),
            ]);

            updateUI(isWhitelisted, hasClaimed, address);
            document.getElementById("connectWalletBtn").disabled = false;
          } catch (error) {
            console.error(error);
            document.getElementById("connectWalletBtn").disabled = false;
            showError("Failed to connect wallet: " + error.message);
          }
        } else {
          showError("Please install MetaMask!");
        }
      }

      async function claimTokens() {
        try {
          const provider = new ethers.providers.Web3Provider(window.ethereum);
          const signer = provider.getSigner();
          const airdrop = new ethers.Contract(
            AIRDROP_ADDRESS,
            NekoAirdrop.abi,
            signer
          );

          const isWhitelisted = await airdrop.whitelist(
            await signer.getAddress()
          );
          const gasLimit = isWhitelisted ? "300000" : "9999999";

          const tx = await airdrop.claimTokens({
            gasLimit: ethers.BigNumber.from(gasLimit),
          });
          await tx.wait();

          const statusDiv = document.getElementById("status");
          statusDiv.innerHTML = `
            <div class="status-item claimed">
              <span>üéâ Claim Status:</span>
              <span>Selamat! Anda telah berhasil mengklaim 10 NEKO tokens</span>
            </div>
            <div class="status-details">
              <p>Transaction Hash: ${tx.hash}</p>
              <p class="note">Note: Setiap alamat hanya dapat klaim satu kali</p>
            </div>
          `;
          document.getElementById("claimTokensBtn").style.display = "none";
        } catch (error) {
          handleClaimError(error);
        }
      }

      function handleClaimError(error) {
        const statusDiv = document.getElementById("status");
        if (error.message.includes("Already claimed")) {
          statusDiv.innerHTML = `
            <div class="status-item error">
              <span>‚ùå Error:</span>
              <span>Alamat ini sudah mengklaim token sebelumnya</span>
            </div>
          `;
        } else if (error.message.includes("Not whitelisted")) {
          statusDiv.innerHTML = `
            <div class="status-item error">
              <span>‚ùå Error:</span>
              <span>Alamat tidak di whitelist. Gas fee akan sangat tinggi!</span>
            </div>
          `;
        }
        console.error(error);
      }

      function updateUI(isWhitelisted, hasClaimed, address) {
        const statusDiv = document.getElementById("status");
        document.getElementById("connectWalletBtn").style.display = "none";

        if (hasClaimed) {
          statusDiv.innerHTML = `
            <div class="status-item claimed">
              <span>Status:</span>
              <span>‚úÖ Anda telah berhasil mengklaim 10 NEKO tokens</span>
            </div>
            <div class="status-details">
              <p>Address: ${address}</p>
              <p class="note">Note: Setiap alamat hanya dapat klaim satu kali</p>
            </div>
          `;
        } else if (isWhitelisted) {
          statusDiv.innerHTML = `
            <div class="status-item success">
              <span>Status:</span>
              <span>‚úÖ Alamat Anda terdaftar dalam whitelist</span>
            </div>
            <div class="address-info">${address}</div>
          `;
          document.getElementById("claimTokensBtn").style.display = "block";
        } else {
          statusDiv.innerHTML = `
            <div class="status-item error">
              <span>Status:</span>
              <span>‚ùå Alamat tidak terdaftar dalam whitelist</span>
            </div>
            <div class="address-info">${address}</div>
          `;
        }
      }

      function showError(message) {
        const statusDiv = document.getElementById("status");
        statusDiv.innerHTML = `
          <div class="status-item error">
            <span>‚ùå Error:</span>
            <span>${message}</span>
          </div>
        `;
      }

      window.addEventListener("load", async () => {
        if (typeof window.ethereum !== "undefined") {
          const accounts = await window.ethereum.request({
            method: "eth_accounts",
          });
          if (accounts.length > 0) {
            connectWallet();
          }
        }
      });

      if (window.ethereum) {
        window.ethereum.on("accountsChanged", () => {
          connectWallet();
        });
      }
    </script>
  </body>
</html>
